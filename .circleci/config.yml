version: 2.1
jobs:
  build-gradle:
    working_directory: ~/appdevtest
    docker:
      - image: cimg/openjdk:16.0.2
    steps:
      - checkout:
          path: ~/appdevtest
      - attach_workspace:
          at: ~/
      - run: sudo chmod +x ./gradlew
      - run: ./gradlew testClasses
      - run: ./gradlew test -p domain
      - run: ./gradlew assemble
      - run: ./gradlew war
      - run: ./gradlew copyWarFileToTarget
      - store_artifacts:
          path: target
      - persist_to_workspace:
          root: ~/appdevtest
          paths:
            - target
    parameters:
      PARAMETERS_PROFILE:
        type: string
        default: env
